name: ZAP API Scan Minimal
on: workflow_dispatch

jobs:
  scan:
    runs-on: ubuntu-latest
    
    steps:
    - name: Setup
      run: |
        echo "üöÄ START"
        mkdir -p ./zap/wrk
        
    - name: Run ZAP
      run: |
        echo "üîç RUNNING ZAP"
        
        TOKEN="${{ github.event.inputs.auth_token }}"
        
        docker run --rm \
          -v $(pwd)/zap/wrk:/zap/wrk:rw \
          zaproxy/zap-weekly python3 /zap/zap-api-scan.py \
          -t "https://raw.githubusercontent.com/Jneira00001/APIv2_DAST/refs/heads/main/openapi.json" \
          -f openapi \
          -z "-config replacer.full_list\\(0\\).matchstr=Authorization -config replacer.full_list\\(0\\).replacement=Token $TOKEN" \
          -O "https://demo.defectdojo.org" \
          -r report.html \
          -s -I
        
        echo "‚úÖ DONE"
        
    - name: Upload
      uses: actions/upload-artifact@v4
      with:
        name: zap-scan
        path: ./zap/wrk/
